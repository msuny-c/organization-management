<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org" th:replace="~{layout :: layout(~{::title}, ~{::content})}">
<head>
    <title>Создание организации</title>
</head>
<body>
    <main th:fragment="content">
        <div class="mb-4">
            <h1 class="mb-1"><i class="bi bi-plus-circle me-2"></i>Создание организации</h1>
            <p class="text-muted mb-0">Пошаговое заполнение информации</p>
        </div>

        <div class="card">
            <div class="card-body p-4">
                <form th:action="@{/organizations/create}" th:object="${organization}" method="post" class="form-wizard">
                    <div class="wizard-progress">
                        <div class="wizard-progress-fill" style="width: 25%;"></div>
                    </div>

                    <div class="wizard-steps">
                        <div class="wizard-step active">
                            <div class="wizard-step-header">
                                <div class="wizard-step-number">1</div>
                                <h3 class="wizard-step-title">Основная информация</h3>
                                <p class="wizard-step-description">Заполните базовые данные организации</p>
                            </div>

                            <div class="form-grid">
                                <div>
                                    <label for="name" class="form-label">Название *</label>
                                    <input type="text" 
                                           class="form-control" 
                                           id="name" 
                                           th:field="*{name}" 
                                           placeholder="Введите название"
                                           required>
                                </div>

                                <div>
                                    <label for="fullName" class="form-label">Полное название</label>
                                    <input type="text" 
                                           class="form-control" 
                                           id="fullName" 
                                           th:field="*{fullName}"
                                           placeholder="Полное официальное название">
                                </div>
                            </div>

                            <div class="form-group-inline">
                                <div>
                                    <label for="employeesCount" class="form-label">Количество сотрудников *</label>
                                    <input type="number" 
                                           class="form-control" 
                                           id="employeesCount" 
                                           th:field="*{employeesCount}" 
                                           min="0" 
                                           placeholder="0"
                                           required>
                                </div>

                                <div>
                                    <label for="rating" class="form-label">Рейтинг *</label>
                                    <input type="number" 
                                           class="form-control" 
                                           id="rating" 
                                           th:field="*{rating}" 
                                           min="1" 
                                           placeholder="1"
                                           required>
                                </div>

                                <div>
                                    <label for="annualTurnover" class="form-label">Годовой оборот (в рублях)</label>
                                    <input type="number" 
                                           class="form-control" 
                                           id="annualTurnover" 
                                           th:field="*{annualTurnover}" 
                                           min="1"
                                           placeholder="Не указано">
                                </div>
                            </div>

                            <div>
                                <label for="type" class="form-label">Тип организации</label>
                                <select class="form-select" id="type" th:field="*{type}">
                                    <option value="">Не указан</option>
                                    <option th:each="type : ${organizationTypes}" 
                                            th:value="${type}" 
                                            th:text="${type}"></option>
                                </select>
                            </div>
                        </div>

                        <div class="wizard-step">
                            <div class="wizard-step-header">
                                <div class="wizard-step-number">2</div>
                                <h3 class="wizard-step-title">Координаты</h3>
                                <p class="wizard-step-description">Укажите географические координаты</p>
                            </div>

                            <div class="mb-3">
                                <label for="coordinatesId" class="form-label">Выбрать существующие</label>
                                <select class="form-select" id="coordinatesId" th:field="*{coordinatesId}">
                                    <option value="">Создать новые...</option>
                                    <option th:each="coord : ${coordinates}" 
                                            th:value="${coord.id}" 
                                            th:text="'X: ' + ${coord.x} + ', Y: ' + ${coord.y}"></option>
                                </select>
                            </div>

                            <div id="newCoordinates">
                                <div class="form-group-inline">
                                    <div>
                                        <label class="form-label">X (≤ 882)</label>
                                        <input type="number" 
                                               step="0.01"
                                               class="form-control" 
                                               th:field="*{coordinates.x}" 
                                               max="882"
                                               placeholder="0.00">
                                    </div>
                                    <div>
                                        <label class="form-label">Y (> -540)</label>
                                        <input type="number" 
                                               class="form-control" 
                                               th:field="*{coordinates.y}"
                                               min="-539"
                                               placeholder="0">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="wizard-step">
                            <div class="wizard-step-header">
                                <div class="wizard-step-number">3</div>
                                <h3 class="wizard-step-title">Почтовый адрес</h3>
                                <p class="wizard-step-description">Обязательная информация для доставки</p>
                            </div>

                            <div class="mb-3">
                                <label for="postalAddressId" class="form-label">Выбрать существующий</label>
                                <select class="form-select" id="postalAddressId" th:field="*{postalAddressId}">
                                    <option value="">Создать новый...</option>
                                    <option th:each="addr : ${addresses}" 
                                            th:value="${addr.id}" 
                                            th:text="${addr.zipCode} + ' - ' + ${addr.town?.name}"></option>
                                </select>
                            </div>

                            <div id="newPostalAddress">
                                <div class="mb-3">
                                    <label class="form-label">Почтовый индекс (≥ 7 символов) *</label>
                                    <input type="text" 
                                           class="form-control" 
                                           th:field="*{postalAddress.zipCode}" 
                                           minlength="7"
                                           required
                                           placeholder="0000000">
                                </div>

                                <div class="mb-3">
                                    <label class="form-label">Город *</label>
                                    <select class="form-select" th:field="*{postalAddress.townId}">
                                        <option value="">Создать новый...</option>
                                        <option th:each="location : ${locations}" 
                                                th:value="${location.id}" 
                                                th:text="${location.name}"></option>
                                    </select>
                                </div>

                                <div id="newPostalTown">
                                    <div class="mb-3">
                                        <label class="form-label">Название города *</label>
                                        <input type="text" 
                                               class="form-control" 
                                               th:field="*{postalAddress.town.name}" 
                                               required
                                               placeholder="Москва">
                                    </div>
                                    <div class="form-group-inline">
                                        <div>
                                            <label class="form-label">X *</label>
                                            <input type="number" 
                                                   class="form-control" 
                                                   th:field="*{postalAddress.town.x}" 
                                                   required
                                                   placeholder="0">
                                        </div>
                                        <div>
                                            <label class="form-label">Y *</label>
                                            <input type="number" 
                                                   class="form-control" 
                                                   th:field="*{postalAddress.town.y}" 
                                                   required
                                                   placeholder="0">
                                        </div>
                                        <div>
                                            <label class="form-label">Z *</label>
                                            <input type="number" 
                                                   step="0.01" 
                                                   class="form-control" 
                                                   th:field="*{postalAddress.town.z}" 
                                                   required
                                                   placeholder="0.00">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="wizard-step">
                            <div class="wizard-step-header">
                                <div class="wizard-step-number">4</div>
                                <h3 class="wizard-step-title">Официальный адрес</h3>
                                <p class="wizard-step-description">Юридический адрес (необязательно)</p>
                            </div>

                            <div class="mb-3">
                                <label for="officialAddressId" class="form-label">Выбрать существующий</label>
                                <select class="form-select" id="officialAddressId" name="officialAddressId">
                                    <option value="">Не указывать...</option>
                                    <option th:each="addr : ${addresses}" 
                                            th:value="${addr.id}" 
                                            th:text="${addr.zipCode} + ' - ' + ${addr.town?.name}"></option>
                                </select>
                            </div>
                            
                            <input type="hidden" id="reusePostalAddressAsOfficial" name="reusePostalAddressAsOfficial" value="false">

                            <div id="newOfficialAddress" style="display: none;">
                                <div class="mb-3">
                                    <label class="form-label">Почтовый индекс (≥ 7 символов) *</label>
                                    <input type="text" 
                                           class="form-control" 
                                           th:field="*{officialAddress.zipCode}" 
                                           minlength="7"
                                           required
                                           placeholder="0000000">
                                </div>

                                <div class="mb-3">
                                    <label class="form-label">Город *</label>
                                    <select class="form-select" th:field="*{officialAddress.townId}">
                                        <option value="">Создать новый...</option>
                                        <option th:each="location : ${locations}" 
                                                th:value="${location.id}" 
                                                th:text="${location.name}"></option>
                                    </select>
                                </div>

                                <div id="newOfficialTown">
                                    <div class="mb-3">
                                        <label class="form-label">Название города *</label>
                                        <input type="text" 
                                               class="form-control" 
                                               th:field="*{officialAddress.town.name}" 
                                               required
                                               placeholder="Москва">
                                    </div>
                                    <div class="form-group-inline">
                                        <div>
                                            <label class="form-label">X *</label>
                                            <input type="number" 
                                                   class="form-control" 
                                                   th:field="*{officialAddress.town.x}" 
                                                   required
                                                   placeholder="0">
                                        </div>
                                        <div>
                                            <label class="form-label">Y *</label>
                                            <input type="number" 
                                                   class="form-control" 
                                                   th:field="*{officialAddress.town.y}" 
                                                   required
                                                   placeholder="0">
                                        </div>
                                        <div>
                                            <label class="form-label">Z *</label>
                                            <input type="number" 
                                                   step="0.01" 
                                                   class="form-control" 
                                                   th:field="*{officialAddress.town.z}" 
                                                   required
                                                   placeholder="0.00">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="wizard-navigation">
                        <button type="button" class="btn btn-secondary wizard-prev">
                            <i class="bi bi-arrow-left me-2"></i>Назад
                        </button>
                        <div class="ms-auto d-flex gap-2">
                            <button type="button" class="btn btn-primary wizard-next">
                                Далее<i class="bi bi-arrow-right ms-2"></i>
                            </button>
                            <button type="submit" class="btn btn-success wizard-submit">
                                <i class="bi bi-check-circle me-2"></i>Создать организацию
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </main>
</body>
</html>

